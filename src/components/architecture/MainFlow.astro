---
// Main Architecture Flowchart
---
<div class="main-flow-container my-8 not-prose">
    <div class="bg-white dark:bg-slate-900 rounded-2xl shadow-xl border border-slate-200 dark:border-white/10 overflow-hidden">
        <div class="p-8 md:p-12 overflow-x-auto">
            <div class="min-w-[800px] flex flex-col gap-8">
                
                <!-- LAYER 1: INPUT -->
                <div class="flex justify-center">
                    <div class="node-box bg-slate-800 text-white p-6 rounded-xl w-64 text-center shadow-lg border-l-4 border-sky-500">
                        <div class="text-xs text-sky-400 font-bold tracking-wider mb-1">SOURCE</div>
                        <div class="text-xl font-bold">Markdown Novel</div>
                        <div class="text-xs text-slate-400 mt-2 font-mono">*.md (Chapter Files)</div>
                    </div>
                </div>

                <!-- CONNECTOR -->
                <div class="flex flex-col items-center h-12">
                    <div class="connector-v"></div>
                    <div class="arrow-down"></div>
                </div>

                <!-- LAYER 2: PROCESSING (Parallel) -->
                <div class="grid grid-cols-2 gap-8 relative">
                    <!-- Left: Static Assets -->
                    <div class="flex flex-col items-center">
                        <div class="node-box bg-white dark:bg-slate-800 border-2 border-slate-200 dark:border-white/10 p-5 rounded-lg w-full max-w-xs shadow-sm">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="bg-amber-100 dark:bg-amber-900/40 text-amber-600 dark:text-amber-400 p-2 rounded-lg font-bold text-sm">A</div>
                                <div class="font-bold text-slate-700 dark:text-slate-200">Asset Definition</div>
                            </div>
                            <ul class="text-sm text-slate-600 dark:text-slate-400 space-y-1">
                                <li class="flex items-center gap-2"><span class="w-1 h-1 bg-amber-400 rounded-full"></span>Character Profiles</li>
                                <li class="flex items-center gap-2"><span class="w-1 h-1 bg-amber-400 rounded-full"></span>Visual Style Guides</li>
                            </ul>
                        </div>
                        <div class="connector-v h-16 w-0.5 bg-slate-300 dark:bg-white/10 my-2"></div>
                    </div>

                    <!-- Right: Dynamic Context -->
                    <div class="flex flex-col items-center">
                        <div class="node-box bg-white dark:bg-slate-800 border-2 border-slate-200 dark:border-white/10 p-5 rounded-lg w-full max-w-xs shadow-sm">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="bg-sky-100 dark:bg-sky-900/40 text-sky-600 dark:text-sky-400 p-2 rounded-lg font-bold text-sm">B</div>
                                <div class="font-bold text-slate-700 dark:text-slate-200">Context "Snoopiest"</div>
                            </div>
                            <ul class="text-sm text-slate-600 dark:text-slate-400 space-y-1">
                                <li class="flex items-center gap-2"><span class="w-1 h-1 bg-sky-400 rounded-full"></span>Chapter Summaries</li>
                                <li class="flex items-center gap-2"><span class="w-1 h-1 bg-sky-400 rounded-full"></span>Hierarchical Backbone</li>
                            </ul>
                        </div>
                        <div class="connector-v h-16 w-0.5 bg-slate-300 dark:bg-white/10 my-2"></div>
                    </div>
                </div>

                <!-- LAYER 3: THE CORE (Prompt Construction) -->
                <div class="bg-slate-50 dark:bg-white/5 rounded-xl border-2 border-dashed border-slate-300 dark:border-white/10 p-6 relative">
                    <div class="absolute -top-3 left-8 bg-slate-100 dark:bg-slate-800 px-2 text-xs font-bold text-slate-500 uppercase">Architecture Design Phase 3</div>
                    
                    <div class="flex flex-col md:flex-row items-center gap-6">
                        <div class="hidden md:flex flex-col justify-center gap-12 w-1/4">
                            <div class="text-right text-xs font-bold text-amber-600 dark:text-amber-400">STATIC<br>CONTEXT</div>
                            <div class="text-right text-xs font-bold text-sky-600 dark:text-sky-400">DYNAMIC<br>CONTEXT</div>
                        </div>
                        
                        <div class="node-box bg-gradient-to-br from-teal-600 to-sky-700 text-white p-6 rounded-xl flex-1 shadow-xl w-full">
                            <div class="text-lg font-bold mb-4 flex items-center gap-2">
                                <span class="text-2xl">⚙️</span> Prompt Construction Engine
                            </div>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                                <div class="bg-white/10 p-3 rounded backdrop-blur-sm border border-white/10">
                                    <div class="text-xs opacity-70 uppercase mb-1">Retrieval</div>
                                    <div class="font-bold text-sm">Fetch Scene Chunk</div>
                                </div>
                                <div class="bg-white/10 p-3 rounded backdrop-blur-sm border border-white/10">
                                    <div class="text-xs opacity-70 uppercase mb-1">Inject</div>
                                    <div class="font-bold text-sm">Character/Visual Defs</div>
                                </div>
                                <div class="bg-white/10 p-3 rounded backdrop-blur-sm border border-white/10">
                                    <div class="text-xs opacity-70 uppercase mb-1">Synthesize</div>
                                    <div class="font-bold text-sm">Final Video Prompt</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- CONNECTOR -->
                <div class="flex flex-col items-center h-8">
                    <div class="connector-v"></div>
                    <div class="arrow-down"></div>
                </div>

                <!-- LAYER 4: OUTPUT PIPELINE -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div class="node-box bg-white dark:bg-slate-800 border-l-4 border-indigo-500 p-4 shadow rounded-r-lg">
                        <div class="font-bold text-indigo-700 dark:text-indigo-400 text-sm">1. Scene Description</div>
                        <div class="text-xs text-slate-500 dark:text-slate-400 mt-1">Lighting, Mood, Action</div>
                    </div>
                    <div class="node-box bg-white dark:bg-slate-800 border-l-4 border-purple-500 p-4 shadow rounded-r-lg">
                        <div class="font-bold text-purple-700 dark:text-purple-400 text-sm">2. Camera Directives</div>
                        <div class="text-xs text-slate-500 dark:text-slate-400 mt-1">Angle, Motion, Zoom</div>
                    </div>
                    <div class="node-box bg-white dark:bg-slate-800 border-l-4 border-pink-500 p-4 shadow rounded-r-lg">
                        <div class="font-bold text-pink-700 dark:text-pink-400 text-sm">3. Video Generation</div>
                        <div class="text-xs text-slate-500 dark:text-slate-400 mt-1">10s Segment Render</div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<style>
    .node-box {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        position: relative;
    }
    .node-box:hover {
        transform: translateY(-4px);
        box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        z-index: 10;
        @apply border-cyan-500/50;
    }
    .connector-v {
        width: 2px;
        background-color: #CBD5E1;
        margin: 0 auto;
        flex-grow: 1;
        min-height: 20px;
    }
    .dark .connector-v {
        background-color: rgba(255,255,255,0.1);
    }
    .arrow-down::after {
        content: '▼';
        font-size: 12px;
        color: #94A3B8;
        display: block;
        text-align: center;
        margin-top: -8px;
    }
</style>
